## Context

当前治理模块已从系统设置中独立到右侧菜单，但角色管理页仍以“点击表格行打开详情/编辑抽屉”为主交互，用户缺少显式操作入口，导致权限编辑功能可发现性不足。权限管理页在授权时依赖逐项点击，在权限数量增长后会造成高操作负担。

现有技术约束：
- 前端基于 React 19 + Ant Design，治理页面主要位于 `web/src/pages/Governance/*`。
- 后端 RBAC 与权限校验由 `/api/v1/rbac/*` 与 Casbin 体系承载，需保持鉴权边界与审计一致。
- 治理入口可见性继续受角色/权限控制，不得因 UI 调整弱化安全约束。

## Goals / Non-Goals

**Goals:**
- 在角色列表中提供显式、可预期的“查看详情/编辑权限”操作入口，降低学习成本。
- 在权限编辑中支持批量勾选、批量取消、分组操作与搜索过滤，提升大规模权限集编辑效率。
- 保持与现有 Users/Roles/Permissions 页面一致的交互模式与反馈机制。
- 在不破坏现有 API 兼容性的前提下，优先复用现有接口，必要时扩展批量提交能力。

**Non-Goals:**
- 不在本变更中重构整套 RBAC 数据模型。
- 不引入新的权限引擎或替换 Casbin。
- 不覆盖与角色治理无关的菜单结构与页面视觉体系。

## Decisions

1. 使用“显式操作列 + 行点击查看”的双通道交互
- 选择：在角色表格增加固定操作列（如“详情”“编辑权限”按钮），同时保留行点击进入详情（弱化为辅助路径）。
- 原因：显式按钮解决可发现性问题，保留行点击满足高频用户效率。
- 备选：仅保留行点击并增加提示文案。放弃原因：提示易被忽略，仍非强可发现。

2. 权限编辑采用“可搜索分组树 + 批量操作条”
- 选择：按模块/资源分组展示权限项；提供组级全选、当前筛选结果全选、反选、清空；实时显示已选计数。
- 原因：在权限规模扩大时，分组和筛选是核心效率手段，优于平铺列表逐项点击。
- 备选：保留扁平复选列表并仅增加搜索。放弃原因：无法解决批量操作和层级感知问题。

3. 提交策略采用“本地变更集 + 一次性提交”
- 选择：前端在抽屉/弹窗中维护 added/removed 变更集，统一调用更新接口提交，展示影响数量与确认。
- 原因：降低频繁 API 调用，便于展示差异和二次确认。
- 备选：每次勾选即刻提交。放弃原因：网络抖动下状态不稳定，回滚与审计可读性差。

4. API 兼容优先，按需扩展批量接口
- 选择：优先复用现有角色权限更新 API；若无法表达变更集，则新增批量更新载荷（如 `grant[]/revoke[]`）。
- 原因：减少后端改造范围，确保平滑落地。
- 备选：引入全新权限管理 API。放弃原因：迁移成本高，风险大。

## Risks / Trade-offs

- [权限项分组口径不一致] → 统一以后端返回的模块标识分组，前端仅做展示层映射并提供兜底“未分组”。
- [批量操作误选风险] → 在提交前展示“新增/移除数量 + 关键权限清单”并要求确认。
- [超大权限集渲染性能下降] → 使用虚拟滚动/按需展开分组，避免一次性渲染全部节点。
- [前后端载荷语义不一致] → 在 API 合同中明确“全量覆盖”与“增量变更”语义，并增加回归测试。

## Migration Plan

1. 前端先落地显式操作入口与新权限编辑交互（保持兼容旧接口）。
2. 若发现旧接口性能/语义不足，再增加批量更新接口并双端联调。
3. 灰度验证治理角色（超级管理员、平台管理员）主流程，观察误操作率与操作时长。
4. 回滚策略：保留旧抽屉组件和旧提交路径，出现严重问题可通过前端开关回退。

## Open Questions

- 权限分组是否已有稳定后端字段（如 module/resource），若缺失需补充标准化映射。
- 是否需要在首版支持“权限模板”（按角色类型一键套用），或留待后续迭代。
- 批量操作的审计粒度要求是记录最终差异，还是记录每个权限项明细。
