## Context

当前平台将用户、角色、权限管理功能归入“系统设置”，在多角色协作场景下存在两类问题：
1. 信息架构不符合高频治理路径，导致入口深、切换成本高。
2. 菜单可见性与接口访问控制边界不一致，存在“看得见但不可用”或“看不见但可直连”的风险。

该变更横跨前端导航、路由鉴权、后端 RBAC 校验与审计记录，属于跨模块且安全敏感改造。相关角色包括平台管理员、安全管理员与普通运维用户。

## Goals / Non-Goals

**Goals:**
- 将用户、角色、权限管理从“系统设置”拆分为独立右侧菜单分组，并形成一致的访问治理入口。
- 建立角色驱动的菜单可见性规则：无权用户默认不显示入口，有权用户可见且可进入。
- 建立“前端可见性 + 后端强鉴权”的双层控制，避免绕过 UI 的越权访问。
- 采用统一 UI/UX 规范，提升管理任务效率与可理解性：
  - 布局：双栏管理视图（左侧实体列表、右侧详情/配置抽屉）
  - 交互：即时筛选、批量操作确认、权限变更二次确认、清晰空态与错误态
  - 可访问性：键盘可达、4.5:1 对比度、44x44 最小可点击区域、明确焦点态

**Non-Goals:**
- 不在本次变更中重构用户/角色/权限底层数据模型。
- 不在本次变更中引入新的认证机制（如 OAuth/OIDC 流程改造）。
- 不在本次变更中扩展细粒度到字段级 ABAC；仅落地菜单与页面/API 访问层的 RBAC。

## Decisions

1. 导航分组独立化：将“用户管理 / 角色管理 / 权限管理”提升为右侧导航中的一级治理分组。
- Rationale: 符合任务导向的 IA，减少在“系统设置”中的功能干扰与路径层级。
- Alternatives:
  - 保持在系统设置内，仅提升排序：改动小，但无法解决职责混杂。
  - 做全局搜索入口：能补充发现性，但不能替代结构化导航。

2. 前端菜单渲染采用“服务端权限快照 + 本地路由守卫”双机制。
- Rationale: 首屏根据权限快照直接决定可见性，路由守卫兜底防止手工输入 URL。
- Alternatives:
  - 仅前端静态角色映射：实现快但与后端策略易漂移。
  - 每次切页实时拉权限：一致性好但性能与交互抖动较差。

3. 后端接口统一接入 Casbin 鉴权中间层并补充审计字段。
- Rationale: 保证“隐藏入口 != 放弃保护”，直接调用 API 仍需角色/策略通过。
- Alternatives:
  - 仅依赖页面入口控制：存在越权风险，不可接受。

4. UI/UX 采用“中性色 + 蓝绿色强调”的企业风格，而非系统设置子页风格复用。
- Rationale: 通过视觉分区表达该模块的治理属性，同时保持与现有 Ant Design 组件体系兼容。
- Interaction details:
  - 页面层级：列表 > 详情抽屉 > 授权弹窗（最多三级）
  - 反馈：权限保存后提供可撤销提示（Toast + 详情链接）
  - 风险操作：角色解绑/权限回收必须二次确认并展示影响对象数量

## Risks / Trade-offs

- [权限快照与 Casbin 策略短暂不一致] → 通过短 TTL 缓存 + 关键操作前强制后端校验缓解。
- [菜单隐藏后用户难以理解“为什么看不到”] → 在个人中心提供“可用权限说明”入口与联系管理员指引。
- [从系统设置迁移导致老路径失效] → 保留过渡期路由重定向并记录访问日志，便于评估切换完成度。
- [交互层级增加导致移动端可用性下降] → 移动端降级为单栏流式页面，抽屉改全屏面板。

## Migration Plan

1. 后端先上线：接口鉴权与审计字段就绪，旧前端路径保持可用。
2. 前端上线新菜单与新路由，旧入口保留软跳转（30 天）。
3. 发布后观察：
   - 403 命中率
   - 旧路径访问量
   - 用户管理任务完成时长
4. 完成迁移后移除旧入口与过渡重定向。

Rollback:
- 前端可通过 feature flag 回退到原“系统设置”入口。
- 后端保持鉴权中间层不回滚，仅放宽新路由映射，避免安全倒退。

## Open Questions

- 特定角色名单是否由固定角色编码（如 `platform-admin`, `iam-admin`）还是由可配置策略驱动？
- 菜单可见性是否需要支持租户级差异（多租户场景）？
- 权限变更是否需要接入现有审批流（若涉及高风险权限授予）？
